import{C as v,Ha as g,J as m,Na as f,e as a,g as c,k as u,n as l,o as p,p as d,q as b,r as n,u as i,x as o,y as h}from"./chunk-T7GGXQV6.js";var s=class r{static TOKEN_KEY="token";getToken(){return localStorage.getItem(r.TOKEN_KEY)||""}saveToken(e){localStorage.setItem(r.TOKEN_KEY,e)}destroyToken(){localStorage.removeItem(r.TOKEN_KEY)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var y=class r{constructor(e,t,w){this.http=e;this.jwtService=t;this.router=w}currentUserSubject=new c(null);currentUser$=this.currentUserSubject.asObservable().pipe(p());isAuthenticated=this.currentUser$.pipe(u(e=>!!e));login(e){return this.http.post("/login",e).pipe(n(t=>{this.setAuth(t.data)}))}signup(e){return this.http.post("/signup",e).pipe(l(t=>this.login({email:e.email,password:e.password})))}logout(){this.http.post("/logout",{}).subscribe(),this.purgeAuth()}getCurrentUser(){let e=localStorage.getItem("userId");return this.http.get(`/users/${e}`).pipe(u(t=>({user:t.data})),n({next:({user:t})=>this.setAuth(t),error:()=>this.purgeAuth()}),d(1))}update(e){return this.http.put("/users",{user:e}).pipe(n(({user:t})=>this.currentUserSubject.next(t)))}setAuth(e){localStorage.setItem("userId",e.id),this.jwtService.saveToken(e.token),this.currentUserSubject.next(e)}purgeAuth(){localStorage.clear(),this.jwtService.destroyToken(),this.currentUserSubject.next(null),this.router.navigate(["/login"])}static \u0275fac=function(t){return new(t||r)(o(g),o(s),o(f))};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};function k(r){r||(v(k),r=h(m));let e=new a(t=>r.onDestroy(t.next.bind(t)));return t=>t.pipe(b(e))}export{s as a,y as b,k as c};
